--- a/trytond/tools/misc.py
+++ b/trytond/tools/misc.py
@@ -32,7 +32,12 @@
         "Join paths and ensure it still below root"
         path = os.path.join(root, *paths)
         path = os.path.normpath(path)
-        if not path.startswith(root):
+        if not os.path.isabs(path):
+            raise IOError("Permission denied: %s" % name)
+        try:
+            if os.path.commonpath([root, path]) != root:
+                raise IOError("Permission denied: %s" % name)
+        except ValueError:
             raise IOError("Permission denied: %s" % name)
         return path
 

