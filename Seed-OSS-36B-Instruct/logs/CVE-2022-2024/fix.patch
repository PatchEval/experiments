--- a/internal/db/repo_editor.go
+++ b/internal/db/repo_editor.go
@@ -485,14 +485,12 @@
 
 // isRepositoryGitPath returns true if given path is or resides inside ".git"
 // path of the repository.
-func isRepositoryGitPath(path string) bool {
-	return strings.HasSuffix(path, ".git") ||
-		strings.Contains(path, ".git/") ||
-		strings.Contains(path, `.git\`) ||
-		// Windows treats ".git." the same as ".git"
-		strings.HasSuffix(path, ".git.") ||
-		strings.Contains(path, ".git./") ||
-		strings.Contains(path, `.git.\`)
+func isRepositoryGitPath(baseDir, relPath string) bool {
+	fullPath := path.Join(baseDir, relPath)
+	cleanPath := path.Clean(fullPath)
+	gitDir := path.Join(baseDir, ".git")
+	cleanGitDir := path.Clean(gitDir) + string(os.PathSeparator)
+	return strings.HasPrefix(cleanPath, cleanGitDir)
 }
 
 func (repo *Repository) UploadRepoFiles(doer *User, opts UploadRepoFileOptions) error {

