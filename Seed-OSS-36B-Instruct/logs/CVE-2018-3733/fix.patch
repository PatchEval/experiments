--- a/crud-file-server.js
+++ b/crud-file-server.js
@@ -3,8 +3,19 @@
 // don't let users crawl up the folder structure by using a/../../../c/d
 var cleanUrl = function(url) { 
 	url = decodeURIComponent(url);
-	while(url.indexOf('..').length > 0) { url = url.replace('..', ''); }
-	return url;
+	var segments = url.split('/');
+	var cleaned = [];
+	for (var i = 0; i < segments.length; i++) {
+		var segment = segments[i];
+		if (segment === '..') {
+			if (cleaned.length > 0) {
+				cleaned.pop();
+			}
+		} else if (segment !== '.' && segment !== '') {
+			cleaned.push(segment);
+		}
+	}
+	return cleaned.join('/');
 };
 
 /*  

